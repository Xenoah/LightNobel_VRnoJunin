# technology.md ─ 技術設定

> **ID接頭辞**: `TECH-xxx`  
> **SI単位系・JST基準**

---

## TECH-001: NH社（Nexus Horizons Inc.）

→ `world_overview.md` 参照。本ファイルでは技術仕様のみ記述。

---

## TECH-003: HVD（Human Virtualization Device）

### 概要

| 項目 | 値 |
|------|----|
| 正式名称 | Human Virtualization Device Mark III |
| 型番 | HVD-MK3-B（β版） |
| 外形寸法 | 長さ 2,200 mm × 幅 900 mm × 高さ 1,100 mm（カプセル含む） |
| 重量 | 約 380 kg（液体未充填時） |
| 電力消費 | 常時 2.8 kW（ピーク時 4.5 kW） |
| カプセル素材 | 強化アクリル＋チタン合金フレーム |
| 液体 | 人体浮揚用フッ素系不活性液体「NexFloat」（比重 1.02、体温 36.5℃ 維持） |

### 五感入出力仕様

| 感覚 | 入力方式（現実→VR） | 出力方式（VR→身体） | ID |
|------|---------------------|---------------------|----|
| 視覚 | 網膜直接投影（レーザー走査型） | N/A（目は閉じた状態、映像は神経刺激） | `TECH-003-V` |
| 聴覚 | 骨伝導＋鼓膜振動併用 | N/A（耳は液体中、音は神経刺激） | `TECH-003-A` |
| 触覚 | 皮膚電極アレイ（512点、全身分布） | 筋電位フィードバック（微弱電流） | `TECH-003-T` |
| 温度覚 | ペルチェ素子アレイ（液体温度変調） | カプセル内液温制御（32〜40℃） | `TECH-003-TH` |
| 痛覚 | **減衰フィルタ適用**（`RULE-005`） | 安全上、現実の痛みは発生しない | `TECH-003-P` |
| 嗅覚 | 鼻腔マイクロニードル経由の嗅覚受容体刺激 | マイクロカプセル式揮発性化合物（256種の基本臭素） | `TECH-003-O` |
| 味覚 | 舌面電極パッド（5基本味＋辛味＋渋味の7パラメータ合成） | N/A（食事は主観体験のみ） | `TECH-003-G` |
| 平衡覚 | 前庭神経電気刺激＋液体浮遊による無重力近似 | 姿勢制御不要（浮遊状態） | `TECH-003-B` |

### 痛覚減衰ルール（RULE-005）

```
減衰率 = min(95%, base_reduction + context_modifier)
base_reduction = 80%  # 標準減衰
context_modifier:
  - 戦闘: +10% (計90%)
  - 環境ダメージ: +15% (計95%, 上限)
  - NPC接触: +5% (計85%)
最低知覚レベル: 「圧迫感」程度。鋭い痛みは遮断。
```

> **RULE-005**: 痛覚は安全上、最大95%減衰される。残り5%は「違和感・圧迫感」として伝達されるが、苦痛には至らない。ただし**恐怖や精神的ストレスは減衰対象外**（`RULE-006`）。

---

## TECH-004: カプセル生命維持システム

### 栄養供給

| 項目 | 仕様 |
|------|----|
| 方式 | 経鼻胃管による液体栄養剤持続注入 |
| 栄養剤 | 「NexNutri」（2,000 kcal/日、ビタミン・ミネラル含有、温度37℃） |
| 投与速度 | 83 mL/h（連続微量投与） |
| リザーバー容量 | 50 L（約25日分） |
| 補充方式 | 外部供給ポートから自動補充（施設側が管理） |

### 排泄処理

| 項目 | 仕様 |
|------|----|
| 排尿 | カテーテル留置 → 廃液タンク（5 L、自動排出） |
| 排便 | 低残渣栄養剤のため排便頻度は約3日に1回。液体内で処理、フィルタリングシステムが回収 |
| 発汗 | 液体内のため蒸発せず。NexFloat液のpHバランサーが吸収 |

### 筋萎縮対策

| 項目 | 仕様 |
|------|----|
| 方式 | 電気筋肉刺激（EMS）による不随意収縮 |
| 刺激頻度 | 6時間ごとに全身15分間の低強度刺激 |
| 効果 | 完全防止は不可能。**4週間で約15%の筋力低下**が見込まれる |
| 長期リスク | 8週間超で深部静脈血栓のリスク上昇（抗凝固剤を栄養剤に混入して対策） |

### 最長稼働時間

| 条件 | 最長時間 |
|------|---------|
| 設計仕様（βテスト想定） | 72時間（3日間） |
| 栄養リザーバー限界 | 25日（外部補充なしの場合） |
| 筋萎縮安全限界 | 56日（8週間）── 以降は不可逆的身体損傷リスク |
| **カプセル自体の物理限界** | **60日** ── フィルター交換、液体劣化、機械部品寿命 |

> **RULE-007**: カプセルの物理限界は60日。事件解決までのデッドラインは **現実時間で約8週間（56日）**。これを超えると身体の不可逆損傷が始まる。

### 緊急停止時のリスク

| シナリオ | リスク |
|---------|-------|
| カプセル電源喪失 | 液体温度低下 → 低体温症（6時間以内に危険） |
| 液体排出 | 急激な圧力変化 → 鼓膜損傷、皮膚圧迫痕 |
| 神経I/Oの急切断 | **意識の強制切断** → 一時的な意識混濁、記憶欠損（数時間〜数日分） |
| 意識格納中の強制切断 | **`RULE-008`: 格納状態での急切断は人格データ破損のリスクあり。これが外部救出を躊躇させる最大の理由** |

---

## TECH-005: 意識同期モジュール

### 概要

| 項目 | 値 |
|------|----|
| モジュール名 | Neural Consciousness Bridge（NCB） |
| バージョン（事件時） | v2.1.0-rc3（リリース候補版） |
| 前バージョン | v2.0.4（安定版、事件なし） |
| 変更内容 | 意識状態のストリーミング方式をバッチ処理 → δ同期（差分同期）に変更 |

### 正常動作

1. 脳から読み取った神経信号をデジタル化（サンプリングレート: 10 kHz、256チャンネル）
2. デジタル信号をVR空間のアバター制御コマンドに変換
3. VR空間のフィードバックを神経刺激に逆変換
4. 意識の「実体」は常に脳内にある。サーバーにはコマンドのみ送信。

### バグの内容（TECH-006: 意識バインド・バグ）

| 項目 | 詳細 |
|------|----|
| 原因 | v2.1.0-rc3 のδ同期モードで、差分ログの書き込み先がローカルバッファではなく **Lethe Chainのステートストレージに誤設定** |
| 発動条件 | δ同期が累積512回を超えた時点で、差分→スナップショット統合処理が発火。この統合処理が意識状態全体をチェーンに書き込む |
| 結果 | 脳内の意識状態が「読み取り＋書き込み」から「参照のみ」に遷移。主観的には変化なし（VR内で遊び続ける） |
| 不可逆性 | 統合スナップショットがチェーンにファイナライズされた時点で、脳側の信号はVR入力としてのみ機能。意識の「実行環境」がチェーン上に移行 |

> **RULE-001**: 意識バインド・バグは v2.1.0-rc3 固有。v2.0.4 以前では発生しない。バグ修正パッチを当てても**既に格納された意識は戻らない**（スナップショットは不可逆にファイナライズ済み）。

---

## TECH-007: 意識の状態表現

### データ構造

```
ConsciousnessState {
  snapshot_id:    bytes32       // Lethe Chain上の一意ID
  version:        uint64        // スナップショット世代番号
  neural_map:     bytes[]       // 神経結合マップ（圧縮済み、約 2.4 TB/人）
  delta_log:      DeltaEntry[]  // 前スナップショットからの差分
  personality:    bytes32       // 人格ハッシュ（同一性検証用）
  timestamp:      uint64        // Lethe Chain上のブロック番号
  integrity_hash: bytes32       // 全フィールドのMerkleルート
}
```

### 更新頻度

| 項目 | 値 |
|------|----|
| δ同期間隔 | 200 ms（5 回/秒） |
| スナップショット統合 | 512 δ ごと（約 102.4 秒 ≒ 1.7 分に1回） |
| チェーン書き込み | スナップショット統合時のみ |

### コピー不可能性（RULE-009）

> **RULE-009**: 意識データは**コピーできない**。技術的にはデータの複製は可能だが、以下の制約がある：

1. **人格ハッシュの一意性**: 同一の `personality` ハッシュを持つ状態が2つ存在すると、Lethe Chainのバリデーターが「重複人格」として後発を拒否する
2. **意識の連続性問題**: 仮にコピーが作れても、どちらが「本人」かは定義不能。作中ではこの哲学的問題を避けるため、技術的にコピーをブロック
3. **スナップショットの相互参照**: 各スナップショットは前世代を参照するチェーン構造。分岐するとデータ整合性が破壊される

### 復元条件

| 条件 | 説明 |
|------|----|
| スナップショット健全性 | `integrity_hash` が正常であること |
| 脳側の受容体制 | カプセル内で神経I/Oが正常動作していること |
| 逆転写プロセス | スナップショットを脳へ再書き込み（推定所要時間: 45〜90分/人） |
| 順序制約 | 最新スナップショットでなければならない（古い世代に戻すと記憶欠損） |

---

## TECH-008: LLM制約（内部AI）

### 概要

Arcadia内には **運営側が配備したLLM**（Large Language Model）が複数稼働している。

| 項目 | 値 |
|------|----|
| モデル名 | Nexus Cognitive Engine（NCE） |
| ID | `TECH-008` |
| 用途 | NPC対話生成、クエスト動的生成、環境描写補助、テスターサポートチャットボット |
| 推論能力 | テキスト生成、コード解析、ログ分析、自然言語推論 |
| パラメータ規模 | 約400Bパラメータ（分散推論） |

### 制約一覧

| 制約ID | 内容 | 根拠 |
|--------|------|------|
| `RULE-010` | **外部ネットワークへの情報送信禁止** | エアギャップ設計。Arcadiaの推論クラスタはLethe Chain内部に閉じており、インターネットへの出口がない |
| `RULE-011` | **テスターの個人情報を出力しない** | プライバシー保護レイヤー（PII検出→自動マスキング） |
| `RULE-012` | **システムプロンプトの開示禁止** | プロンプトインジェクション防止。システムプロンプトの内容を要求しても拒否 |
| `RULE-013` | **管理者コマンドの実行禁止** | NCEの実行権限はReadOnlyロール。書き込み/設定変更は不可 |

### 利用可能な機能（テスターがハッキングなしに使えるもの）

| 機能 | 説明 |
|------|----|
| 自然言語対話 | 質問応答、議論、ブレインストーミング |
| コードレビュー | テスターが書いたコードの分析・改善提案 |
| ログ分析 | BSS投稿の分析、パターン検出 |
| 仮説生成 | 状況分析に基づく仮説の生成（ただし検証はテスター自身が行う） |

### ストーリー上の重要性

主人公は NCE に「なぜログアウトできないのか」を分析させ、内部構造の手がかりを得る。ただし NCE は **外部への通報** や **管理者権限の取得** を代行することはできない（`RULE-010`, `RULE-013`）。NCEは「道具」であり「救世主」ではない。

---

## TECH-009: 保守API（Maintenance API）

### 概要

| 項目 | 値 |
|------|----|
| 正式名称 | Arcadia Maintenance Service（AMS） |
| ID | `TECH-009` |
| 用途 | 開発中のデバッグ、ワールドパラメータ調整、ログ収集 |
| 本来のアクセス方法 | NH社の開発用VPN → 管理コンソール → 認証トークン |
| 事件時の状態 | **大部分がβ版で無効化済みだが、一部エンドポイントが残存** |

### 残存エンドポイント発見経路

> **RULE-014**: 保守APIの発見は段階的であり、チープな魔法解決は禁止。

| 段階 | 発見内容 | 方法 | コスト/リスク |
|------|---------|------|-------------|
| 1 | APIドキュメントの断片 | The Undercroft の旧デバッグエリアに放置されたNPC（開発用テストNPC）の会話ログに、エンドポイントURLが平文で残存 | デバッグエリアは高レベルモンスターが徘徊、到達に戦闘リスク |
| 2 | ヘルスチェック・エンドポイント | `/api/v1/health` が認証なしで応答。サーバーのバージョン情報とモジュール一覧を返す | 情報漏洩のみ、直接的リスクなし |
| 3 | 監査ログ・エンドポイント | `/api/v1/audit/recent` が低権限ロール（テスターロール）で部分アクセス可能。設定ミスで READ 権限がテスターに付与されていた | 監査ログにアクセスした記録が残り、外部（もし見ていれば）に検知される |
| 4 | デバッグコンソール | `/api/v1/debug/console` が存在するが認証必須。ただし認証トークンの生成ロジックが監査ログ内に痕跡として残っていた | トークン生成には暗号学的パズルを解く必要あり（30人以上のエンジニアが数日間協力） |
| 5 | 権限昇格 | デバッグコンソールからロール変更APIを叩き、`MAINTENANCE_ADMIN` ロールを取得 | ロール変更には既存の管理者トークンが必要 → 期限切れトークンの再署名で突破（`GOV-004`参照） |
| 6 | ガバナンス参照 | `MAINTENANCE_ADMIN` でLethe Chainのガバナンスコントラクトを参照可能に | 凍結構造の全貌が判明 |

---

## TECH-010: VR基盤アーキテクチャ

### レイヤー構成

```
┌─────────────────────────────────────────────┐
│  Layer 5: ユーザー体験層                      │
│  （アバター、UI、BSS、クエスト）               │
├─────────────────────────────────────────────┤
│  Layer 4: ゲームロジック層                     │
│  （物理演算、AI-NPC、経済システム）             │
├─────────────────────────────────────────────┤
│  Layer 3: 意識同期層（NCB）                    │
│  （神経信号↔VRコマンド変換）                   │
├─────────────────────────────────────────────┤
│  Layer 2: Lethe Chain（ブロックチェーン層）     │
│  （状態保持、意識スナップショット、ガバナンス）   │
├─────────────────────────────────────────────┤
│  Layer 1: インフラ層                          │
│  （物理サーバー、ネットワーク、電力）            │
└─────────────────────────────────────────────┘
```

### 各層の責務

| 層 | 責務 | 事件時の状態 |
|----|------|------------|
| L5 | ユーザーが触れるすべて | **正常動作中**（テスターはゲームを楽しんでいる） |
| L4 | ゲーム世界のシミュレーション | **正常動作中** |
| L3 | 脳↔VR間の信号変換 | **バグあり**（意識がL2に格納される原因） |
| L2 | 状態永続化＋ガバナンス | **ガバナンス凍結**（停止コマンドが実行不能） |
| L1 | 物理的なサーバー運用 | **正常稼働中**（止めると意識データ破損） |

---

## ASSUMPTION

- **ASSUMPTION-TECH-001**: NexFloat液の具体的な化学組成は物語上不要。「フッ素系不活性液体」で十分。読者から質問があれば「パーフルオロカーボン系」と回答可能。
- **ASSUMPTION-TECH-002**: NCEのパラメータ規模400Bは2031年時点で妥当と仮定。物語内で具体的な数値に言及する必要はないが、整合性チェック用に記録。
- **ASSUMPTION-TECH-003**: 意識データ2.4TB/人は現在の脳科学の推定（コネクトーム全体で約1PB）から大幅に圧縮した値。圧縮アルゴリズムはNH社独自技術として設定。

---

## OPEN_QUESTION

- **OQ-TECH-001**: δ同期の累積回数512回で発火するバグの技術的詳細をさらに掘り下げるか？
  - 代替案A: 「バッファオーバーフロー的なもの」で済ませる（ライト読者向き）
  - 代替案B: 具体的なコード断片を示す（ハードSF読者向き）

- **OQ-TECH-002**: NCEが「自意識」を持つ展開を入れるか？
  - 代替案A: NCEは純粋なツール。自意識なし（推奨。テーマを「人間の意識」に集中させるため）
  - 代替案B: 終盤でNCEが自意識の萌芽を見せる（テーマ拡散のリスク）
